<main>
    <!-- Notification Toast Container -->
    <div class="notification-container">
        <div *ngFor="let notif of notifications" 
             class="notification" 
             [class.success]="notif.type === 'success'"
             [class.info]="notif.type === 'info'"
             [class.warning]="notif.type === 'warning'"
             [class.error]="notif.type === 'error'"
             (click)="removeNotification(notif.id)">
            <span class="notif-icon">
                <ng-container *ngIf="notif.type === 'success'">âœ“</ng-container>
                <ng-container *ngIf="notif.type === 'info'">â„¹</ng-container>
                <ng-container *ngIf="notif.type === 'warning'">âš </ng-container>
                <ng-container *ngIf="notif.type === 'error'">âœ•</ng-container>
            </span>
            <span class="notif-message">{{ notif.message }}</span>
        </div>
    </div>

    <!-- Victory Overlay -->
    <div class="victory-overlay" *ngIf="showVictoryOverlay" (click)="showVictoryOverlay = false">
        <!-- Confetti -->
        <div class="confetti-container">
            <div *ngFor="let piece of confettiPieces" 
                 class="confetti-piece"
                 [style.left.%]="piece.left"
                 [style.animation-delay.s]="piece.delay"
                 [style.animation-duration.s]="piece.duration"
                 [style.background-color]="piece.color"
                 [style.width.px]="piece.size"
                 [style.height.px]="piece.size * 0.4">
            </div>
        </div>
        
        <!-- Victory Card -->
        <div class="victory-card" (click)="$event.stopPropagation()">
            <div class="trophy-icon">ğŸ†</div>
            <h2 class="victory-title" [class.red]="winner === 'red'" [class.yellow]="winner === 'yellow'">
                {{ winner === myColor ? 'YOU WIN!' : 'YOU LOSE!' }}
            </h2>
            <p class="victory-subtitle">
                <span class="winner-dot" [class.red]="winner === 'red'" [class.yellow]="winner === 'yellow'"></span>
                {{ winner?.toUpperCase() }} PLAYER WON!
            </p>
            <div class="victory-message" *ngIf="winner === myColor">
                ğŸ‰ Congratulations on your victory! You connected 4 in a row!
            </div>
            <div class="victory-message" *ngIf="winner !== myColor">
                ğŸ˜” Better luck next time! Challenge them to a rematch!
            </div>
            <button class="btn-play-again" (click)="restart(); showVictoryOverlay = false">
                <span class="btn-icon">ğŸ”„</span> Play Again
            </button>
            <button class="btn-close-overlay" (click)="showVictoryOverlay = false">
                Continue Viewing Board
            </button>
        </div>
    </div>

    <header>
        <h1>Connect 4</h1>
        <div class="subtitle">Realtime P2P Strategy Game</div>
    </header>

    <!-- Controls & Status -->
    <div class="controls-card">
        <div class="status-bar" [class.connected]="isConnected" [class.connecting]="isConnecting">
            <div class="connection-indicator">
                <div class="dot" [class.green]="isConnected" [class.orange]="isConnecting" [class.gray]="!isConnected && !isConnecting"></div>
                <span class="connection-text">
                    <ng-container *ngIf="isConnected">Connected</ng-container>
                    <ng-container *ngIf="isConnecting">Connecting...</ng-container>
                    <ng-container *ngIf="!isConnected && !isConnecting">Not Connected</ng-container>
                </span>
            </div>
            <span class="status-message">{{ status || 'Start a game to begin' }}</span>
        </div>

        <!-- Game Setup -->
        <div *ngIf="!isConnected && !isConnecting" class="game-setup">
            <div class="room-id-display" *ngIf="peerId">
                <span class="room-label">Your Room ID:</span>
                <div class="room-id-box">
                    <span class="room-id">{{ peerId }}</span>
                    <button class="btn-copy" (click)="copyRoomId()" title="Copy to Clipboard">ğŸ“‹</button>
                </div>
            </div>

            <div class="setup-divider">
                <span>Create or Join</span>
            </div>

            <div class="setup-options">
                <div class="option-card create-option" (click)="createRoom()">
                    <div class="option-icon">ğŸ®</div>
                    <div class="option-title">Create Room</div>
                    <div class="option-desc">Start a new game and invite a friend</div>
                </div>

                <div class="option-card join-option">
                    <div class="option-icon">ğŸ”—</div>
                    <div class="option-title">Join Room</div>
                    <div class="option-desc">Enter your friend's Room ID</div>
                    <div class="join-form">
                        <input #roomInput 
                               placeholder="Enter 4-digit ID" 
                               maxlength="4"
                               class="room-input"
                               (keyup.enter)="joinRoom(roomInput.value)">
                        <button class="btn-join" (click)="joinRoom(roomInput.value)">
                            Join â†’
                        </button>
                    </div>
                </div>
            </div>

            <div class="error-message" *ngIf="connectionError">
                âš ï¸ {{ connectionError }}
            </div>
        </div>

        <!-- Connected State -->
        <div *ngIf="isConnected" class="connected-info">
            <div class="player-badge" [class.red]="myColor === 'red'" [class.yellow]="myColor === 'yellow'">
                <span class="badge-dot"></span>
                <span>You are {{ myColor === 'red' ? 'RED ğŸ”´' : 'YELLOW ğŸŸ¡' }}</span>
            </div>
            <div class="turn-indicator">
                <span *ngIf="!gameOver">
                    {{ turn === myColor ? "ğŸ¯ Your turn!" : "â³ Opponent's turn" }}
                </span>
            </div>
        </div>

        <!-- Connecting State -->
        <div *ngIf="isConnecting" class="connecting-state">
            <div class="spinner"></div>
            <span>Connecting to room...</span>
        </div>

        <!-- Game Over Actions -->
        <div *ngIf="gameOver && isConnected" class="game-over-actions">
            <div class="game-result" [class.winner]="winner === myColor" [class.loser]="winner !== myColor">
                <span *ngIf="winner">{{ winner === myColor ? 'ğŸ‰ Victory!' : 'ğŸ˜¢ Defeat!' }}</span>
                <span *ngIf="!winner">ğŸ¤ Draw!</span>
            </div>
            <button class="btn-restart" (click)="restart()">
                <span class="btn-icon">ğŸ”„</span> Play Again
            </button>
        </div>
    </div>

    <!-- Game Board -->
    <div class="game-container" [class.disabled]="!isConnected || gameOver">
        <div class="board">
            <div class="column-indicators">
                <div *ngFor="let col of [0,1,2,3,4,5,6]" 
                     class="column-indicator"
                     [class.active]="turn === myColor && isConnected && !gameOver"
                     [class.red]="myColor === 'red'"
                     [class.yellow]="myColor === 'yellow'">
                    â–¼
                </div>
            </div>
            <div class="board-grid">
                <div class="row" *ngFor="let row of board; let r = index">
                    <div class="cell" 
                         *ngFor="let cell of row; let c = index" 
                         [class.red]="cell === 'red'"
                         [class.yellow]="cell === 'yellow'" 
                         [class.clickable]="turn === myColor && !gameOver && isConnected && !board[0][c]"
                         (click)="play(c)" 
                         [title]="'Column ' + (c + 1)">
                        <div class="cell-shine" *ngIf="cell"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions -->
    <div class="instructions">
        <h3>ğŸ® How to Play</h3>
        <ol>
            <li><strong>Create</strong> a room and share the 4-digit ID, or <strong>Join</strong> using a friend's ID.</li>
            <li><strong>Red ğŸ”´</strong> goes first. Players take turns dropping discs into columns.</li>
            <li>The first player to connect <strong>4 discs</strong> in a row wins! (Horizontal, vertical, or diagonal)</li>
        </ol>
    </div>
</main>